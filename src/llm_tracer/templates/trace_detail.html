{% extends "base_dashboard.html" %}

{% block title %}Trace Detail - LLM Tracer{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav class="flex items-center text-sm mb-4">
    <a href="/traces" class="text-slate-500 hover:text-slate-700">Traces</a>
    <svg class="mx-2 h-4 w-4 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
    </svg>
    <span class="text-slate-900 font-medium">{{ trace.trace_id|truncate(20) }}</span>
</nav>

<!-- Trace Overview -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
        <h1 class="text-xl font-bold text-slate-900">Trace Details</h1>
        <div class="flex items-center gap-2">
            {% if trace.status == 'success' %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-emerald-100 text-emerald-800">Success</span>
            {% elif trace.status == 'error' %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">Error</span>
            {% else %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-amber-100 text-amber-800">Running</span>
            {% endif %}
        </div>
    </div>
    
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div>
            <p class="text-sm text-slate-500">Model</p>
            <p class="font-medium text-slate-900">{{ trace.model_name }}</p>
        </div>
        <div>
            <p class="text-sm text-slate-500">Latency</p>
            <p class="font-medium text-slate-900">{{ trace.latency_ms }}ms</p>
        </div>
        <div>
            <p class="text-sm text-slate-500">Total Tokens</p>
            <p class="font-medium text-slate-900">{{ trace.total_tokens }}</p>
        </div>
        <div>
            <p class="text-sm text-slate-500">Time</p>
            <p class="font-medium text-slate-900">{{ trace.start_time|strftime('%b %d, %H:%M:%S') }}</p>
        </div>
    </div>
</div>

<!-- Input/Output -->
<div class="grid md:grid-cols-2 gap-6">
    <!-- Input -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="px-6 py-4 bg-slate-50 border-b border-slate-200">
            <h2 class="font-semibold text-slate-900">Input</h2>
        </div>
        <div class="p-6">
            <pre class="text-sm text-slate-700 whitespace-pre-wrap bg-slate-50 p-4 rounded-lg overflow-auto max-h-96">{{ trace.input_data|pprint }}</pre>
        </div>
    </div>
    
    <!-- Output -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="px-6 py-4 bg-slate-50 border-b border-slate-200">
            <h2 class="font-semibold text-slate-900">Output</h2>
        </div>
        <div class="p-6">
            <pre class="text-sm text-slate-700 whitespace-pre-wrap bg-slate-50 p-4 rounded-lg overflow-auto max-h-96">{{ trace.output_data|pprint }}</pre>
        </div>
    </div>
</div>

{% if trace.tool_calls %}
<!-- Tool Calls -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mt-6">
    <div class="px-6 py-4 bg-slate-50 border-b border-slate-200">
        <h2 class="font-semibold text-slate-900">Tool Calls</h2>
    </div>
    <div class="p-6">
        <pre class="text-sm text-slate-700 whitespace-pre-wrap bg-slate-50 p-4 rounded-lg overflow-auto max-h-96">{{ trace.tool_calls|pprint }}</pre>
    </div>
</div>
{% endif %}

{% if trace.error_message %}
<!-- Error -->
<div class="bg-red-50 rounded-xl border border-red-200 overflow-hidden mt-6">
    <div class="px-6 py-4 bg-red-100 border-b border-red-200">
        <h2 class="font-semibold text-red-800">Error</h2>
    </div>
    <div class="p-6">
        <pre class="text-sm text-red-700 whitespace-pre-wrap">{{ trace.error_message }}</pre>
    </div>
</div>
{% endif %}

<!-- Metadata -->
<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mt-6">
    <div class="px-6 py-4 bg-slate-50 border-b border-slate-200">
        <h2 class="font-semibold text-slate-900">Metadata</h2>
    </div>
    <div class="p-6">
        <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
                <p class="text-slate-500">Trace ID</p>
                <p class="font-mono text-slate-900">{{ trace.trace_id }}</p>
            </div>
            <div>
                <p class="text-slate-500">Provider</p>
                <p class="text-slate-900">{{ trace.model_provider|default('-') }}</p>
            </div>
            <div>
                <p class="text-slate-500">Prompt Tokens</p>
                <p class="text-slate-900">{{ trace.prompt_tokens }}</p>
            </div>
            <div>
                <p class="text-slate-500">Completion Tokens</p>
                <p class="text-slate-900">{{ trace.completion_tokens }}</p>
            </div>
            <div>
                <p class="text-slate-500">Session ID</p>
                <p class="font-mono text-slate-900">{{ trace.session_id|default('-') }}</p>
            </div>
            <div>
                <p class="text-slate-500">User ID</p>
                <p class="text-slate-900">{{ trace.user_id|default('-') }}</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
